# 数据库多表设计与查询

## 一、多表关系

### 1.1 概述
在数据库设计中，表与表之间的关系由业务逻辑决定，主要分为三种类型：
- 一对多（多对一）
- 多对多
- 一对一


#### 1.1.1 一对多（多对一）
- **案例**：部门与员工的关系  
- **关系**：一个部门可包含多个员工，一个员工仅属于一个部门  
- **实现方式**：在"多"的一方（员工表）中添加外键，指向"一"的一方（部门表）的主键  

| 员工表(emp)       |        |        |            | 部门表(dept)       |        |
|-------------------|--------|--------|------------|--------------------|--------|
| id                | name   | age    | dept_id（外键） | id                 | name   |
| 1                 | 张无忌 | 20     | 1          | 1                  | 研发部 |
| 2                 | 杨逍   | 33     | 1          | 2                  | 市场部 |
| 3                 | 赵敏   | 18     | 2          | 3                  | 财务部 |
| 4                 | 常遇春 | 43     | 2          | 4                  | 销售部 |


#### 1.1.2 多对多
- **案例**：学生与课程的关系  
- **关系**：一个学生可选修多门课程，一门课程可被多个学生选修  
- **实现方式**：新增中间表（如学生课程关系表），包含两个外键分别关联双方主键  

| 学生表(student)   |        |          |
|-------------------|--------|----------|
| id                | name   | no       |
| 1                 | 黛绮丝 | 2000100101 |
| 2                 | 谢逊   | 2000100102 |
| 3                 | 殷天正 | 2000100103 |
| 4                 | 韦一笑 | 2000100104 |

| 学生课程关系表(student_course) |            |            |
|--------------------------------|------------|------------|
| id                             | studentid（外键） | courseid（外键） |
| 1                              | 1          | 1          |
| 2                              | 1          | 2          |
| 3                              | 1          | 3          |
| 4                              | 2          | 1          |
| 5                              | 2          | 4          |

| 课程表(course)    |        |
|-------------------|--------|
| id                | name   |
| 1                 | Java   |
| 2                 | PHP    |
| 3                 | MySQL  |
| 4                 | Hadoop |


#### 1.1.3 一对一
- **案例**：用户与用户详情的关系  
- **关系**：一对一用于单表拆分，将基础字段与详情字段分离以提升效率  
- **实现方式**：在任意一方添加外键关联另一方主键，并设置外键为唯一（UNIQUE）  

| 用户基本信息表(tb_user) |        |       |        |          |
|-------------------------|--------|-------|--------|----------|
| id                      | name   | age   | gender | phone    |
| 1                       | 黄渤   | 45    | 1      | 18800001111 |
| 2                       | 冰冰   | 35    | 2      | 18800002222 |
| 3                       | 码云   | 55    | 1      | 18800008888 |
| 4                       | 李彦宏 | 50    | 1      | 18800009999 |

| 用户教育信息表(tb_user_edu) |        |        |                  |                  |             |        |
|-----------------------------|--------|--------|------------------|------------------|-------------|--------|
| id                          | degree | major  | primaryschool    | middleschool     | university  | userid（外键+唯一） |
| 1                           | 本科   | 舞蹈   | 静安区第一小学   | 静安区第一中学   | 北京舞蹈学院 | 1      |
| 2                           | 硕士   | 表演   | 朝阳区第一小学   | 朝阳区第一中学   | 北京电影学院 | 2      |
| 3                           | 本科   | 英语   | 杭州市第一小学   | 杭州市第一中学   | 杭州师范大学 | 3      |
| 4                           | 本科   | 应用数学 | 阳泉第一小学     | 阳泉区第一中学   | 清华大学    | 4      |


## 二、多表查询概述

### 2.1 多表查询分类

#### 2.1.1 连接查询
- **内连接**：查询两张表的交集部分数据  
- **外连接**：  
  - 左外连接：查询左表全部数据 + 两表交集部分  
  - 右外连接：查询右表全部数据 + 两表交集部分  
- **自连接**：表与自身连接查询（需使用表别名）  

![连接查询示意图]()


#### 2.1.2 子查询
嵌套在其他SQL语句中的查询语句，可作为条件、结果集或数据源使用。


### 2.2 内连接查询
#### 语法示例
##### 隐式内连接
```sql
SELECT 字段列表 
FROM 表1, 表2 
WHERE 连接条件 AND 筛选条件;
```

##### 显式内连接（推荐）
```sql
SELECT 字段列表 
FROM 表1 
[INNER] JOIN 表2 
ON 连接条件 
WHERE 筛选条件;
```

**说明**：内连接仅返回两表中符合连接条件的交集数据。


### 2.3 外连接查询
#### 语法示例
##### 左外连接
```sql
SELECT 字段列表 
FROM 表1 
LEFT [OUTER] JOIN 表2 
ON 连接条件;
```
**说明**：返回左表所有数据，以及两表交集部分数据（右表无匹配时显示NULL）。

##### 右外连接
```sql
SELECT 字段列表 
FROM 表1 
RIGHT [OUTER] JOIN 表2 
ON 连接条件;
```
**说明**：返回右表所有数据，以及两表交集部分数据（左表无匹配时显示NULL）。
