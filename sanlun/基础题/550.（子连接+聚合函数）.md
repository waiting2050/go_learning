# 玩家次日留存率 SQL 笔记
## 1. 需求
计算首次登录后第二天再次登录的玩家比率（保留2位小数），公式：`符合条件的玩家数 / 总玩家数`


## 2. 核心思路
1. 先查每个玩家的**首次登录日期**（子查询 `p`）
2. 用 `LEFT JOIN` 关联原表，筛选出“登录日期 = 首次日期 + 1天”的记录（子查询 `a`）
3. 用 `AVG(a.event_date IS NOT NULL)` 计算比率（`IS NOT NULL` 非空返回1，空返回0，平均值即比率）


## 3. 完整代码
```sql
SELECT 
  ROUND(AVG(a.event_date IS NOT NULL), 2) AS fraction
FROM (
  -- 子查询：获取每个玩家的首次登录日期
  SELECT player_id, MIN(event_date) AS login
  FROM Activity
  GROUP BY player_id
) p
-- 关联原表，筛选次日登录记录
LEFT JOIN Activity a 
  ON p.player_id = a.player_id 
  AND DATEDIFF(a.event_date, p.login) = 1;
```


## 4. 关键逻辑解析
| 代码片段                | 作用                                                                 |
|-------------------------|----------------------------------------------------------------------|
| `MIN(event_date)`       | 按 `player_id` 分组，取每个玩家的首次登录日期                         |
| `DATEDIFF(a.event_date, p.login) = 1` | 筛选“登录日期比首次日期晚1天”的记录                                  |
| `AVG(a.event_date IS NOT NULL)` | 统计“有次日登录记录”的玩家占比（非空→1，空→0，平均值即比率）         |
| `ROUND(..., 2)`         | 结果保留2位小数                                                      |


## 5. 示例验证
- 总玩家数：3（玩家1、2、3）
- 符合条件玩家：1（仅玩家1次日登录）
- 计算结果：`1/3 ≈ 0.33`，与示例输出一致

**注意**：与1174的区别在于这道题要求的日期是只有一列的，而1174的日期是不同的两列，所以本题左连接，另一题就不用，直接在where里判断即可
