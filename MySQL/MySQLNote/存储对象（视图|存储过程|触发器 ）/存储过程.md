# 基本语法

## 1. 介绍

存储过程是事先经过编译并存储在数据库中的一段 SQL 语句的集合。

* **简化开发**：调用存储过程可以简化应用开发人员的很多工作。
* **减少传输**：减少数据在数据库和应用服务器之间的传输，对于提高数据处理的效率是有好处的。
* **本质**：思想上很简单，就是数据库 SQL 语言层面的代码**封装与重用**。

## 2. 特点

* **封装，复用**：将复杂的业务逻辑封装起来，方便多次调用。
* **可以接收参数，也可以返回数据**：支持输入参数（IN）和输出参数（OUT/INOUT），增强了灵活性。
* **减少网络交互，效率提升**：因为多条 SQL 语句在一次调用中完成，显著降低了客户端与服务器之间的网络往返开销。

## 存储过程 - 基本语法

### 1. 创建 (Create)

使用 `CREATE PROCEDURE` 语句来定义存储过程，其核心逻辑写在 `BEGIN ... END` 块之间。

```sql
CREATE PROCEDURE 存储过程名称 ([ 参数列表 ])
BEGIN
    -- SQL 语句
END ;

```

> **注意**：在命令行中执行创建语句时，通常需要先通过关键字 `delimiter` 指定新的 SQL 语句结束符，以防止内部的分号导致语句提前结束。

### 2. 调用 (Call)

使用 `CALL` 关键字来执行已经定义好的存储过程。

```sql
CALL 名称 ([ 参数 ]);

```

### 3. 查看 (View)

* **查询状态信息**：可以从系统表 `INFORMATION_SCHEMA.ROUTINES` 中查询指定数据库的存储过程详情。
```sql
SELECT * FROM INFORMATION_SCHEMA.ROUTINES WHERE ROUTINE_SCHEMA = 'xxx'; 

```


* **查询定义语句**：查看创建该存储过程的具体 SQL 源码。
```sql
SHOW CREATE PROCEDURE 存储过程名称;

```



### 4. 删除 (Drop)

使用 `DROP PROCEDURE` 语句删除指定的存储过程。

```sql
DROP PROCEDURE [ IF EXISTS ] 存储过程名称;

```


# 存储过程 - 变量

## 1. 系统变量

**系统变量** 是由 MySQL 服务器提供，不是用户定义的，属于服务器层面。系统变量分为 **全局变量 (GLOBAL)** 和 **会话变量 (SESSION)**。

### 2. 查看系统变量

可以通过以下方式查看所有或指定的系统变量：

* **查看所有系统变量**：
```sql
SHOW [ SESSION | GLOBAL ] VARIABLES ;

```


* **通过 LIKE 模糊匹配方式查找变量**：
```sql
SHOW [ SESSION | GLOBAL ] VARIABLES LIKE '......' ;

```


* **查看指定变量的值**：
```sql
SELECT @@[ SESSION | GLOBAL ] 系统变量名 ;

```



### 3. 设置系统变量

可以通过 `SET` 指令为变量赋值：

* **方式一**：
```sql
SET [ SESSION | GLOBAL ] 系统变量名 = 值 ;

```


* **方式二**：
```sql
SET @@[ SESSION | GLOBAL ] 系统变量名 = 值 ;

```



---

### ⚠️ 注意事项：

1. **默认级别**：如果没有指定 `SESSION` 或 `GLOBAL`，默认是 **SESSION（会话变量）**。
2. **时效性**：MySQL 服务重新启动之后，所设置的全局参数会**失效**。
3. **永久生效**：要想让设置永久有效，需要在 MySQL 的配置文件 `/etc/my.cnf` 中进行配置。

## 2. 用户定义变量

**用户定义变量** 是用户根据需要自己定义的变量。用户变量不用提前声明，在用的时候直接用 “`@变量名`” 使用就可以。其作用域为当前连接。

### 赋值

可以通过以下几种方式为用户定义变量赋值：

* **使用 SET 语句赋值**：
```sql
SET @var_name = expr [, @var_name = expr] ... ;
SET @var_name := expr [, @var_name := expr] ... ;

```


* **使用 SELECT 语句赋值**：
```sql
SELECT @var_name := expr [, @var_name := expr] ... ;
SELECT 字段名 INTO @var_name FROM 表名;

```



### 使用

通过 `SELECT` 语句来查看或使用变量的值：

```sql
SELECT @var_name ;

```

---

### ⚠️ 注意事项：

* 用户定义的变量无需对其进行声明或初始化，只不过获取到的值为 `NULL`。
* 赋值时使用 `:=` 是 MySQL 中推荐的赋值方式，用以区分比较操作符 `=`。
