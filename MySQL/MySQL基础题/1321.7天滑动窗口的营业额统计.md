### 标题：7天滑动窗口的营业额统计


#### 问题核心
计算连续7天（含当天及前6天）的总营业额和平均营业额，结果从第7天开始显示，按日期升序排列。


#### 测试数据（Customer表）
| customer_id | name    | visited_on | amount |
|-------------|---------|------------|--------|
| 1           | Jhon    | 2019-01-01 | 100    |
| 2           | Daniel  | 2019-01-02 | 110    |
| 3           | Jade    | 2019-01-03 | 120    |
| 4           | Khaled  | 2019-01-04 | 130    |
| 5           | Winston | 2019-01-05 | 110    |
| 6           | Elvis   | 2019-01-06 | 140    |
| 7           | Anna    | 2019-01-07 | 150    |
| 8           | Maria   | 2019-01-08 | 80     |
| 9           | Jaze    | 2019-01-09 | 110    |
| 1           | Jhon    | 2019-01-10 | 130    |
| 3           | Jade    | 2019-01-10 | 150    |


#### 关键思路
1. **每日金额聚合**：同一天可能有多个顾客消费，需先按日期汇总每日总金额。
2. **7天滑动总和**：用窗口函数 `sum() over (order by visited_on range interval 6 day preceding)` 计算当天及前6天的累计金额。
3. **筛选有效日期**：只保留距离最早日期≥6天的记录（确保有完整7天数据）。
4. **计算平均值**：总金额除以7，保留2位小数。


#### 正确SQL
```sql
select 
    visited_on,
    amount,
    round(amount / 7, 2) as average_amount
from (
    select 
        visited_on,
        sum(daily_amount) over (
            order by visited_on 
            range interval 6 day preceding
        ) as amount
    from (
        -- 按日期汇总每日总金额
        select 
            visited_on,
            sum(amount) as daily_amount
        from Customer
        group by visited_on
    ) as daily_total
) as t
-- 从第7天开始显示结果
where datediff(visited_on, (select min(visited_on) from Customer)) >= 6
order by visited_on;
```


#### 输出结果
| visited_on | amount | average_amount |
|------------|--------|----------------|
| 2019-01-07 | 860    | 122.86         |
| 2019-01-08 | 840    | 120.00         |
| 2019-01-09 | 840    | 120.00         |
| 2019-01-10 | 1000   | 142.86         |